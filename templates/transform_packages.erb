<%=
ensuredPackages = {}

# Ensure a default ensure state is always present.
@packageConfig.each{|packageName, packageProps|
  if packageProps
    ensuredPackages[packageName] = packageProps.clone
  else
    ensuredPackages[packageName] = {}
  end

  # Puppet will normally define but not create packages
  if !ensuredPackages[packageName]["ensure"]
    ensuredPackages[packageName]["ensure"] = "present"
  end
}

# Send the result back to Puppet
ensuredPackages.to_yaml
%>
